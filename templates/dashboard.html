<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PermitTracker - Professional Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', path='css/dashboard.css') }}">
    <link rel="icon" href="/static/images/logo.png" type="image/png">
    <link rel="apple-touch-icon" href="/static/images/logo.png">
    <script src="{{ url_for('static', path='js/vendor/chart.min.js') }}"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <img src="{{ url_for('static', path='images/logo.png') }}" alt="PermitTracker" style="width: 100%; height: 100%; object-fit: contain;" onerror="this.src='{{ url_for('static', path='images/placeholder-logo.svg') }}';">
                    </div>
                    <span>PermitTracker</span>
                </div>
                
                <div class="header-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalPermits">-</div>
                        <div class="stat-label">PERMITS VISIBLE</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="todayPermits">-</div>
                        <div class="stat-label">Today</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="newDrillCount">-</div>
                        <div class="stat-label">New Drill</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="amendmentCount">-</div>
                        <div class="stat-label">Amendments</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="dashboard-grid">
                <!-- Main Permits Table -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            Real-Time Permit Feed
                            <span class="live-indicator">
                                <span class="live-dot"></span>
                                LIVE
                            </span>
                        </div>
                        <div class="card-subtitle" id="lastUpdate">Loading...</div>
                    </div>
                    
                    <!-- Filters -->
                    <div class="card-content">
                        <div class="filters">
                            <div class="filter-group">
                                <label class="filter-label">Operator</label>
                                <input type="text" id="operatorFilter" class="filter-input" placeholder="Search operator...">
                                <div class="multi-select-dropdown">
                                    <button type="button" class="multi-select-btn" id="operatorMultiBtn">
                                        📋 Select Multiple
                                    </button>
                                    <div class="multi-select-content" id="operatorMultiSelect" style="display: none;">
                                        <div class="multi-select-header">
                                            <input type="text" placeholder="Search operators..." id="operatorSearch" class="multi-select-search">
                                            <button type="button" class="select-all-btn" data-target="operator">Select All</button>
                                        </div>
                                        <div class="multi-select-options" id="operatorOptions">
                                            <!-- Dynamic content -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">County</label>
                                <input type="text" id="countyFilter" class="filter-input" placeholder="Search county...">
                                <div class="multi-select-dropdown">
                                    <button type="button" class="multi-select-btn" id="countyMultiBtn">
                                        📋 Select Multiple
                                    </button>
                                    <div class="multi-select-content" id="countyMultiSelect" style="display: none;">
                                        <div class="multi-select-header">
                                            <input type="text" placeholder="Search counties..." id="countySearch" class="multi-select-search">
                                            <button type="button" class="select-all-btn" data-target="county">Select All</button>
                                        </div>
                                        <div class="multi-select-options" id="countyOptions">
                                            <!-- Dynamic content -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Purpose</label>
                                <select id="purposeFilter" class="filter-input">
                                    <option value="">All Purposes</option>
                                    <option value="new drill">New Drill</option>
                                    <option value="amendment">Amendment</option>
                                    <option value="reentry">Reentry</option>
                                    <option value="recomplete">Recomplete</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">Queue Status</label>
                                <select id="queueFilter" class="filter-input">
                                    <option value="">All Statuses</option>
                                    <option value="mapping">Mapping</option>
                                    <option value="review">Review</option>
                                    <option value="approved">Approved</option>
                                    <option value="pending">Pending</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="filter-label">&nbsp;</label>
                                <button id="clearFilters" class="btn btn-secondary">Clear Filters</button>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1rem; color: var(--text-secondary); font-size: 0.875rem;">
                            Showing <span id="filteredCount">0</span> permits
                        </div>
                    </div>
                    
                    <!-- Loading Indicator -->
                    <div id="loading" class="loading" style="display: none;">
                        <div class="spinner"></div>
                        Loading permits...
                    </div>
                    
                    <!-- Permits Cards organized by County -->
                    <div id="permitsContainer">
                        <!-- Dynamic county sections with permit cards -->
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="sidebar">
                    <!-- Controls -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Controls</div>
                        </div>
                        <div class="card-content">
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <button id="refreshBtn" class="btn btn-primary">
                                    🔄 Refresh Data
                                </button>
                                
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="autoRefreshToggle" checked>
                                    <span>Auto-refresh (1 min)</span>
                                </label>
                                
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="showDismissedToggle">
                                    <span>Show dismissed</span>
                                </label>
                                
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                    <input type="checkbox" id="todayOnlyToggle">
                                    <span>📅 Today only</span>
                                </label>
                                
                                <a href="/api/v1/permits/export" class="btn btn-secondary">
                                    📊 Export CSV
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Quick Stats</div>
                            <div class="card-subtitle">Last 24 hours</div>
                        </div>
                        <div class="card-content">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-number" id="totalPermits2">-</div>
                                    <div class="stat-description">Permits Visible</div>
                                </div>
                                <div class="stat-card success">
                                    <div class="stat-number" id="newPermitsToday">-</div>
                                    <div class="stat-description">New Today</div>
                                </div>
                                <div class="stat-card warning">
                                    <div class="stat-number" id="amendmentsToday">-</div>
                                    <div class="stat-description">Amendments</div>
                                </div>
                                <div class="stat-card secondary">
                                    <div class="stat-number" id="uniqueOperators">-</div>
                                    <div class="stat-description">Operators</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Operators -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Top Operators</div>
                            <div class="card-subtitle">Most active this week</div>
                        </div>
                        <div class="card-content">
                            <div id="topOperators">
                                <div style="color: var(--text-secondary); text-align: center; padding: 1rem;">
                                    Loading...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Reservoirs -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Top Reservoirs</div>
                            <div class="card-subtitle">Most active formations</div>
                        </div>
                        <div class="card-content">
                            <div id="reservoirStats">
                                <div style="color: var(--text-secondary); text-align: center; padding: 1rem;">
                                    Loading...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reservoir Management -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">🎯 Reservoir Management</div>
                            <div class="card-subtitle">Manage field name mappings</div>
                        </div>
                        <div class="card-content">
                            <div style="text-align: center; margin-bottom: 0.75rem;">
                                <button onclick="window.dashboard.openReservoirManager()" 
                                        style="padding: 0.5rem 1rem; background: var(--gradient-primary); color: white; border: none; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem;">
                                    🔧 Manage Reservoirs
                                </button>
                            </div>
                            <div id="reviewQueue">
                                <div style="color: var(--text-secondary); text-align: center; padding: 1rem;">
                                    Loading...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Parsing Status -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">🔍 Parsing Status</div>
                            <div class="card-subtitle">Real-time parsing monitoring</div>
                        </div>
                        <div class="card-content">
                            <div id="parsingStats">
                                <div style="color: var(--text-secondary); text-align: center; padding: 1rem;">
                                    Loading...
                                </div>
                            </div>
                            <div style="margin-top: 1rem; text-align: center;">
                                <button onclick="window.dashboard.openParsingDashboard()" 
                                        style="padding: 0.5rem 1rem; background: var(--gradient-primary); color: white; border: none; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem;">
                                    📊 View Details
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- System Status -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">System Status</div>
                        </div>
                        <div class="card-content">
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 0.875rem;">Scraper</span>
                                    <span style="color: var(--success-color); font-weight: 500;">● Online</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 0.875rem;">Database</span>
                                    <span style="color: var(--success-color); font-weight: 500;">● Connected</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 0.875rem;">API</span>
                                    <span style="color: var(--success-color); font-weight: 500;">● Healthy</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 0.875rem;">Auto-Refresh</span>
                                    <span id="refreshStatus" style="color: var(--success-color); font-weight: 500;">● Active</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', path='js/dashboard.js') }}"></script>
</body>
</html>
